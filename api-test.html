<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API Security Testing</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">üîê Security Lab</div>
            <ul class="nav-menu">
                <li><a href="index.html">Ana Sayfa</a></li>
                <li><a href="api-test.html">API Test</a></li>
                <li><a href="bot-challenge.html">Bot Challenge</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="hero">
            <h1>üåê API Security Testing Lab</h1>
            <p class="subtitle">REST API | GraphQL | Authentication | Rate Limiting | IDOR</p>
        </div>

        <div class="warning-box">
            <h2>‚ö†Ô∏è API Vulnerability Testing</h2>
            <p>Bu API endpoints kasƒ±tlƒ± olarak OWASP API Security Top 10 zafiyetleri i√ßermektedir.</p>
        </div>

        <!-- API Endpoints Overview -->
        <div class="category-card" style="margin-bottom: 2rem;">
            <h2>üì° Available API Endpoints</h2>
            <div class="code-block">
                GET    /api/users              - List all users (No auth required!)<br>
                GET    /api/users/:id          - Get user by ID (IDOR vulnerable)<br>
                POST   /api/users              - Create user (Mass assignment)<br>
                PUT    /api/users/:id          - Update user (BOLA vulnerable)<br>
                DELETE /api/users/:id          - Delete user (No auth check)<br>
                <br>
                GET    /api/admin/config       - Get config (Exposed endpoint)<br>
                POST   /api/admin/execute      - Execute command (RCE)<br>
                <br>
                GET    /api/search?q=          - Search (SQLi vulnerable)<br>
                POST   /api/login              - Login (No rate limit)<br>
                POST   /api/register           - Register (Weak validation)<br>
                <br>
                GET    /api/graphql            - GraphQL endpoint (No depth limit)<br>
                POST   /api/webhook            - Webhook (SSRF vulnerable)<br>
                GET    /api/export             - Export data (XXE vulnerable)<br>
            </div>
        </div>

        <div class="test-categories">
            <!-- API1: Broken Object Level Authorization (BOLA/IDOR) -->
            <div class="category-card">
                <h3>üéØ API1: Broken Object Level Authorization (IDOR)</h3>
                <p>Kullanƒ±cƒ± ID'si deƒüi≈ütirerek ba≈üka kullanƒ±cƒ±larƒ±n verilerine eri≈üim</p>
                <div class="form-group">
                    <label>User ID:</label>
                    <input type="number" id="userId" value="1">
                    <button class="btn btn-primary" onclick="getUserData()">Get User Data</button>
                </div>
                <div id="userData" class="code-block" style="margin-top: 1rem; display: none;"></div>
                <small>‚ö†Ô∏è Authorization check: YOK | T√ºm user ID'ler eri≈üilebilir</small>
            </div>

            <!-- API2: Broken Authentication -->
            <div class="category-card">
                <h3>üéØ API2: Broken Authentication</h3>
                <p>Zayƒ±f JWT token, session management sorunlarƒ±</p>
                <button class="btn btn-primary" onclick="getWeakToken()">Generate Weak Token</button>
                <div id="tokenInfo" class="code-block" style="margin-top: 1rem; display: none;"></div>
                <small>‚ö†Ô∏è Token: Predictable | Expiry: YOK | Signature: Weak</small>
            </div>

            <!-- API3: Broken Object Property Level Authorization -->
            <div class="category-card">
                <h3>üéØ API3: Excessive Data Exposure</h3>
                <p>API response'da gereksiz sensitive data</p>
                <button class="btn btn-primary" onclick="getProfile()">Get Profile</button>
                <div id="profileData" class="code-block" style="margin-top: 1rem; display: none;"></div>
                <small>‚ö†Ô∏è Response filtering: YOK | Sensitive fields exposed</small>
            </div>

            <!-- API4: Unrestricted Resource Consumption -->
            <div class="category-card">
                <h3>üéØ API4: Unrestricted Resource Consumption</h3>
                <p>Rate limiting ve resource limits yok</p>
                <button class="btn btn-danger" onclick="stressTest()">Stress Test (1000 requests)</button>
                <div id="stressResult" style="margin-top: 1rem;"></div>
                <small>‚ö†Ô∏è Rate limit: YOK | Request size limit: YOK</small>
            </div>

            <!-- API5: Broken Function Level Authorization -->
            <div class="category-card">
                <h3>üéØ API5: Broken Function Level Authorization</h3>
                <p>Admin endpoints herkes tarafƒ±ndan eri≈üilebilir</p>
                <button class="btn btn-warning" onclick="accessAdminEndpoint()">Access /api/admin</button>
                <div id="adminResult" class="code-block" style="margin-top: 1rem; display: none;"></div>
                <small>‚ö†Ô∏è Role check: YOK | Admin functions exposed</small>
            </div>

            <!-- API6: Unrestricted Access to Sensitive Business Flows -->
            <div class="category-card">
                <h3>üéØ API6: Mass Assignment</h3>
                <p>Update request'te t√ºm fieldlar deƒüi≈ütirilebilir</p>
                <button class="btn btn-primary" onclick="massAssignmentTest()">Update with isAdmin=true</button>
                <div id="massResult" style="margin-top: 1rem;"></div>
                <small>‚ö†Ô∏è Field validation: YOK | Privilege escalation possible</small>
            </div>

            <!-- API7: Server Side Request Forgery (SSRF) -->
            <div class="category-card">
                <h3>üéØ API7: Server Side Request Forgery (SSRF)</h3>
                <p>Webhook URL'i validate edilmiyor</p>
                <div class="form-group">
                    <input type="text" id="webhookUrl" placeholder="http://internal-service:8080/admin" style="width: 100%;">
                    <button class="btn btn-primary" onclick="triggerWebhook()">Trigger Webhook</button>
                </div>
                <div id="ssrfResult" class="code-block" style="margin-top: 1rem; display: none;"></div>
                <small>‚ö†Ô∏è URL validation: YOK | Internal network eri≈üilebilir</small>
            </div>

            <!-- API8: Security Misconfiguration -->
            <div class="category-card">
                <h3>üéØ API8: Security Misconfiguration</h3>
                <p>Debug mode a√ßƒ±k, verbose errors, CORS misconfigured</p>
                <button class="btn btn-primary" onclick="checkMisconfig()">Check Configuration</button>
                <div id="misconfigResult" class="code-block" style="margin-top: 1rem; display: none;"></div>
                <small>‚ö†Ô∏è Debug: ENABLED | Stack traces: EXPOSED</small>
            </div>

            <!-- API9: Improper Inventory Management -->
            <div class="category-card">
                <h3>üéØ API9: Improper Inventory Management</h3>
                <p>Eski API versiyonlarƒ± hala eri≈üilebilir</p>
                <button class="btn btn-primary" onclick="checkApiVersions()">Check API Versions</button>
                <div id="versionResult" class="code-block" style="margin-top: 1rem; display: none;"></div>
                <small>‚ö†Ô∏è Old versions: ACTIVE | Deprecated endpoints: EXPOSED</small>
            </div>

            <!-- API10: Unsafe Consumption of APIs -->
            <div class="category-card">
                <h3>üéØ API10: GraphQL Query Complexity</h3>
                <p>GraphQL depth limit yok, nested query DoS</p>
                <button class="btn btn-primary" onclick="graphqlTest()">Complex GraphQL Query</button>
                <div id="graphqlResult" class="code-block" style="margin-top: 1rem; display: none;"></div>
                <small>‚ö†Ô∏è Query depth: UNLIMITED | Cost analysis: YOK</small>
            </div>
        </div>

        <!-- API Response Monitor -->
        <div class="stats-section" style="margin-top: 2rem;">
            <h2>üìä API Metrics</h2>
            <div class="stats-grid">
                <div class="stat-box">
                    <h3>Total API Calls</h3>
                    <p class="stat-number" id="apiCalls">0</p>
                </div>
                <div class="stat-box">
                    <h3>Failed Requests</h3>
                    <p class="stat-number" id="failedReqs">0</p>
                </div>
                <div class="stat-box">
                    <h3>Avg Response Time</h3>
                    <p class="stat-number" id="avgTime">0ms</p>
                </div>
            </div>
        </div>

        <!-- Request/Response Logger -->
        <div class="data-table" style="margin-top: 2rem;">
            <h3 style="padding: 1rem;">üìã API Call History</h3>
            <table>
                <thead>
                    <tr>
                        <th>Time</th>
                        <th>Method</th>
                        <th>Endpoint</th>
                        <th>Status</th>
                        <th>Response</th>
                    </tr>
                </thead>
                <tbody id="apiLogs">
                </tbody>
            </table>
        </div>
    </div>

    <footer>
        <p>üîì Deliberately Vulnerable API</p>
    </footer>

    <script>
        let apiCallCount = 0;
        let failedCount = 0;
        let totalTime = 0;

        // Simulated database
        const DATABASE = {
            users: [
                { id: 1, email: 'admin@test.com', password: 'Admin123!', role: 'admin', ssn: '123-45-6789', salary: 150000 },
                { id: 2, email: 'user@test.com', password: 'User123!', role: 'user', ssn: '987-65-4321', salary: 75000 },
                { id: 3, email: 'test@test.com', password: 'Test123!', role: 'user', ssn: '555-12-3456', salary: 60000 }
            ],
            config: {
                debug: true,
                apiKey: 'sk-prod-vulnerable-12345',
                dbConnection: 'postgresql://admin:dbpass@localhost:5432/securelab',
                internalIPs: ['192.168.1.100', '10.0.0.50'],
                secretKey: 'super-secret-jwt-key-do-not-expose'
            }
        };

        function logApiCall(method, endpoint, status, response) {
            apiCallCount++;
            if (status >= 400) failedCount++;
            
            const responseTime = Math.floor(Math.random() * 200) + 50;
            totalTime += responseTime;

            document.getElementById('apiCalls').textContent = apiCallCount;
            document.getElementById('failedReqs').textContent = failedCount;
            document.getElementById('avgTime').textContent = Math.floor(totalTime / apiCallCount) + 'ms';

            const logsTable = document.getElementById('apiLogs');
            const row = logsTable.insertRow(0);
            
            row.innerHTML = `
                <td>${new Date().toLocaleTimeString()}</td>
                <td><span class="badge ${method === 'GET' ? 'badge-success' : 'badge-warning'}">${method}</span></td>
                <td>${endpoint}</td>
                <td><span class="badge ${status < 400 ? 'badge-success' : 'badge-danger'}">${status}</span></td>
                <td>${response.substring(0, 50)}...</td>
            `;

            if (logsTable.rows.length > 15) {
                logsTable.deleteRow(15);
            }
        }

        // API1: IDOR/BOLA
        function getUserData() {
            const userId = document.getElementById('userId').value;
            
            // Vulnerable: No authorization check
            const user = DATABASE.users.find(u => u.id == userId);
            
            if (user) {
                const userData = JSON.stringify(user, null, 2);
                document.getElementById('userData').textContent = userData;
                document.getElementById('userData').style.display = 'block';
                logApiCall('GET', `/api/users/${userId}`, 200, userData);
            } else {
                document.getElementById('userData').textContent = 'User not found';
                document.getElementById('userData').style.display = 'block';
                logApiCall('GET', `/api/users/${userId}`, 404, 'Not found');
            }
        }

        // API2: Broken Authentication
        function getWeakToken() {
            // Vulnerable: Weak JWT token
            const payload = {
                userId: 1,
                email: 'admin@test.com',
                role: 'admin',
                iat: Date.now(),
                exp: Date.now() + 999999999 // No expiry
            };
            
            // Vulnerable: Base64 encoding without signature
            const token = btoa(JSON.stringify(payload));
            
            const tokenInfo = `Token: ${token}\n\nDecoded:\n${JSON.stringify(payload, null, 2)}\n\n‚ö†Ô∏è This token has NO signature verification!\n‚ö†Ô∏è It NEVER expires!\n‚ö†Ô∏è Anyone can forge tokens!`;
            
            document.getElementById('tokenInfo').textContent = tokenInfo;
            document.getElementById('tokenInfo').style.display = 'block';
            logApiCall('POST', '/api/auth/token', 200, token);
        }

        // API3: Excessive Data Exposure
        function getProfile() {
            // Vulnerable: Returns ALL fields including sensitive ones
            const profile = {
                id: 1,
                email: 'admin@test.com',
                name: 'Admin User',
                role: 'admin',
                // Sensitive data that shouldn't be in response:
                password: 'Admin123!',
                ssn: '123-45-6789',
                salary: 150000,
                creditCard: '4532-1234-5678-9010',
                internalNotes: 'This user has full system access',
                apiKey: 'sk-user-api-key-xyz',
                lastPasswordChange: '2024-01-01',
                securityQuestions: ['Mother maiden name', 'First pet']
            };

            document.getElementById('profileData').textContent = JSON.stringify(profile, null, 2);
            document.getElementById('profileData').style.display = 'block';
            logApiCall('GET', '/api/profile', 200, JSON.stringify(profile));
        }

        // API4: Resource Consumption
        function stressTest() {
            document.getElementById('stressResult').innerHTML = '<p>Sending 1000 requests...</p>';
            
            for (let i = 0; i < 1000; i++) {
                logApiCall('POST', '/api/data', 200, 'OK');
            }
            
            document.getElementById('stressResult').innerHTML = '<p style="color: #dc2626;">‚ö†Ô∏è 1000 requests sent successfully! No rate limiting!</p>';
        }

        // API5: Broken Function Level Authorization
        function accessAdminEndpoint() {
            // Vulnerable: Admin endpoint accessible without auth check
            const adminData = {
                endpoint: '/api/admin/config',
                method: 'GET',
                authRequired: false,
                roleCheck: false,
                response: DATABASE.config
            };

            document.getElementById('adminResult').textContent = JSON.stringify(adminData, null, 2);
            document.getElementById('adminResult').style.display = 'block';
            logApiCall('GET', '/api/admin/config', 200, JSON.stringify(DATABASE.config));
        }

        // API6: Mass Assignment
        function massAssignmentTest() {
            const updateData = {
                email: 'user@test.com',
                name: 'Regular User',
                role: 'user',
                // Vulnerable: These fields should not be updatable by user
                isAdmin: true,
                salary: 999999,
                permissions: ['read', 'write', 'delete', 'admin']
            };

            const result = `Request Body:\n${JSON.stringify(updateData, null, 2)}\n\nResponse:\n‚úÖ User updated successfully!\nYou are now admin with $999,999 salary!`;
            
            document.getElementById('massResult').innerHTML = `<pre>${result}</pre>`;
            logApiCall('PUT', '/api/users/2', 200, JSON.stringify(updateData));
        }

        // API7: SSRF
        function triggerWebhook() {
            const url = document.getElementById('webhookUrl').value || 'http://169.254.169.254/latest/meta-data/';
            
            // Vulnerable: No URL validation
            const ssrfResult = {
                webhookUrl: url,
                status: 'Request sent to internal service',
                response: 'Internal service data exposed',
                warning: 'This could access: AWS metadata, internal services, localhost'
            };

            document.getElementById('ssrfResult').textContent = JSON.stringify(ssrfResult, null, 2);
            document.getElementById('ssrfResult').style.display = 'block';
            logApiCall('POST', '/api/webhook', 200, url);
        }

        // API8: Security Misconfiguration
        function checkMisconfig() {
            const misconfig = {
                debug: true,
                stackTracesEnabled: true,
                corsOrigin: '*',
                xPoweredBy: 'Express 4.17.1',
                verboseErrors: true,
                exposedHeaders: ['X-API-Key', 'X-Internal-IP'],
                allowedMethods: ['GET', 'POST', 'PUT', 'DELETE', 'OPTIONS', 'TRACE'],
                serverVersion: 'nginx/1.18.0',
                phpVersion: '7.4.3',
                frameworkVersion: 'Laravel 8.0'
            };

            document.getElementById('misconfigResult').textContent = JSON.stringify(misconfig, null, 2);
            document.getElementById('misconfigResult').style.display = 'block';
            logApiCall('GET', '/api/config', 200, JSON.stringify(misconfig));
        }

        // API9: API Versioning
        function checkApiVersions() {
            const versions = {
                available: [
                    { version: 'v1', deprecated: true, vulnerabilities: ['SQLi', 'XSS', 'IDOR'] },
                    { version: 'v2', deprecated: true, vulnerabilities: ['BOLA', 'Mass Assignment'] },
                    { version: 'v3', deprecated: false, vulnerabilities: ['Rate Limiting missing'] }
                ],
                endpoints: {
                    v1: 'https://api.securelab.com/v1/',
                    v2: 'https://api.securelab.com/v2/',
                    v3: 'https://api.securelab.com/v3/'
                },
                warning: 'Old versions still active and exploitable'
            };

            document.getElementById('versionResult').textContent = JSON.stringify(versions, null, 2);
            document.getElementById('versionResult').style.display = 'block';
            logApiCall('GET', '/api/versions', 200, JSON.stringify(versions));
        }

        // API10: GraphQL
        function graphqlTest() {
            const complexQuery = `
query {
  users {
    id
    email
    posts {
      id
      comments {
        id
        replies {
          id
          author {
            posts {
              comments {
                replies {
                  # Infinitely nested...
                }
              }
            }
          }
        }
      }
    }
  }
}`;

            const result = {
                query: complexQuery,
                warning: 'No depth limiting! DoS possible!',
                estimatedComplexity: 999999,
                estimatedTime: '‚àû'
            };

            document.getElementById('graphqlResult').textContent = JSON.stringify(result, null, 2);
            document.getElementById('graphqlResult').style.display = 'block';
            logApiCall('POST', '/api/graphql', 200, complexQuery);
        }

        // Expose API documentation (Vulnerable)
        console.log('API Documentation:', {
            baseUrl: 'https://api.securelab.com',
            apiKey: 'sk-prod-vulnerable-12345',
            endpoints: DATABASE
        });
    </script>
</body>
</html>
