<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Åifremi Unuttum - Security Lab</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">ğŸ” Security Lab</div>
            <ul class="nav-menu">
                <li><a href="index.html">Ana Sayfa</a></li>
                <li><a href="login.html">GiriÅŸ</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="form-container">
            <h1>ğŸ”‘ Åifremi Unuttum</h1>
            <p style="color: #6b7280; margin-bottom: 1.5rem;">Åifre sÄ±fÄ±rlama baÄŸlantÄ±sÄ± gÃ¶ndereceÄŸiz</p>

            <div id="message" style="margin-bottom: 1rem;"></div>

            <form id="forgotForm">
                <div class="form-group">
                    <label for="email">E-posta Adresi</label>
                    <input type="email" id="email" name="email" placeholder="ornek@email.com" required>
                </div>

                <button type="submit" class="btn btn-primary btn-block">SÄ±fÄ±rlama BaÄŸlantÄ±sÄ± GÃ¶nder</button>

                <div style="margin-top: 1rem; text-align: center;">
                    <a href="login.html" style="color: var(--primary-color);">GiriÅŸ sayfasÄ±na dÃ¶n</a>
                </div>
            </form>
        </div>

        <!-- Password Reset Link (if generated) -->
        <div id="resetLinkContainer" style="display: none;" class="form-container" style="margin-top: 2rem;">
            <h2>ğŸ”— Password Reset Link Generated</h2>
            <p class="alert alert-warning">âš ï¸ Åifre sÄ±fÄ±rlama baÄŸlantÄ±sÄ± (genelde e-posta ile gÃ¶nderilir, ama burada gÃ¶steriyoruz):</p>
            <div class="code-block" id="resetLink"></div>
            <button class="btn btn-primary" onclick="useResetLink()">Bu BaÄŸlantÄ±yÄ± Kullan</button>
        </div>

        <!-- Reset Password Form -->
        <div id="resetFormContainer" style="display: none;" class="form-container" style="margin-top: 2rem;">
            <h2>ğŸ” Yeni Åifre Belirle</h2>
            <form id="resetForm">
                <div class="form-group">
                    <label for="new_password">Yeni Åifre</label>
                    <input type="password" id="new_password" name="new_password" required>
                </div>

                <div class="form-group">
                    <label for="confirm_password">Yeni Åifre (Tekrar)</label>
                    <input type="password" id="confirm_password" name="confirm_password" required>
                </div>

                <button type="submit" class="btn btn-success btn-block">Åifreyi GÃ¼ncelle</button>
            </form>
        </div>

        <!-- Vulnerabilities -->
        <div class="test-categories" style="margin-top: 2rem;">
            <div class="category-card">
                <h2>ğŸ¯ Password Reset Vulnerabilities</h2>
                <ul>
                    <li><strong>Account Enumeration:</strong> FarklÄ± hata mesajlarÄ± ile hesap varlÄ±ÄŸÄ± tespit edilebilir</li>
                    <li><strong>Predictable Tokens:</strong> Reset token tahmin edilebilir</li>
                    <li><strong>Token Reuse:</strong> AynÄ± token birden fazla kullanÄ±labilir</li>
                    <li><strong>No Token Expiration:</strong> Tokenlar sonsuza kadar geÃ§erli</li>
                    <li><strong>No Rate Limiting:</strong> SÄ±nÄ±rsÄ±z reset isteÄŸi</li>
                    <li><strong>Token in URL:</strong> Reset token URL'de (log dosyalarÄ±na dÃ¼ÅŸebilir)</li>
                    <li><strong>Host Header Injection:</strong> Reset linki manipÃ¼le edilebilir</li>
                </ul>
            </div>

            <div class="category-card">
                <h2>ğŸ’‰ Attack Scenarios</h2>
                <h3>1. Token Prediction</h3>
                <div class="code-block">
                    Token format: base64(email:timestamp)<br>
                    Example: YWRtaW5AdGVzdC5jb206MTcwNTUwMDAwMDAw<br>
                    Easily reversible and predictable!
                </div>

                <h3>2. Account Takeover</h3>
                <ol>
                    <li>Request reset for victim's email</li>
                    <li>Predict/bruteforce the reset token</li>
                    <li>Use token to reset password</li>
                    <li>Account compromised!</li>
                </ol>

                <h3>3. Host Header Injection</h3>
                <div class="code-block">
                    POST /forgot-password<br>
                    Host: evil.com<br>
                    <br>
                    Reset link sent to user:<br>
                    http://evil.com/reset?token=xyz<br>
                    Attacker receives the token!
                </div>
            </div>
        </div>
    </div>

    <footer>
        <p>ğŸ”“ Deliberately Vulnerable Password Reset</p>
    </footer>

    <script>
        const existingUsers = ['admin@test.com', 'user@test.com', 'test@test.com'];
        let resetAttempts = parseInt(localStorage.getItem('resetAttempts') || '0');

        document.getElementById('forgotForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('email').value;
            resetAttempts++;
            localStorage.setItem('resetAttempts', resetAttempts);

            // Vulnerable: Account enumeration
            if (!existingUsers.includes(email)) {
                showMessage('Bu e-posta adresi sistemde kayÄ±tlÄ± deÄŸil.', 'danger');
                return;
            }

            // Vulnerable: Predictable token generation
            const timestamp = Date.now();
            const token = btoa(email + ':' + timestamp); // Weak token!

            // Store token (in real app this would be in database)
            localStorage.setItem('resetToken', token);
            localStorage.setItem('resetEmail', email);
            localStorage.setItem('resetTimestamp', timestamp);

            showMessage('âœ… Åifre sÄ±fÄ±rlama baÄŸlantÄ±sÄ± gÃ¶nderildi!', 'success');

            // Vulnerable: Exposing reset link (should be sent via email only)
            const resetUrl = window.location.origin + '/reset-password?token=' + token;
            document.getElementById('resetLink').textContent = resetUrl;
            document.getElementById('resetLinkContainer').style.display = 'block';

            console.log('Reset token generated:', {
                email: email,
                token: token,
                timestamp: timestamp,
                decodedToken: atob(token),
                expiresIn: 'NEVER (no expiration!)',
                reuseAllowed: true
            });
        });

        function useResetLink() {
            document.getElementById('resetFormContainer').style.display = 'block';
            window.scrollTo(0, document.body.scrollHeight);
        }

        document.getElementById('resetForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const newPassword = document.getElementById('new_password').value;
            const confirmPassword = document.getElementById('confirm_password').value;

            if (newPassword !== confirmPassword) {
                showMessage('Åifreler eÅŸleÅŸmiyor!', 'danger');
                return;
            }

            // Vulnerable: No password strength requirement
            if (newPassword.length < 3) {
                showMessage('Åifre Ã§ok kÄ±sa (min 3 karakter)', 'danger');
                return;
            }

            const resetEmail = localStorage.getItem('resetEmail');
            
            showMessage(`âœ… Åifre baÅŸarÄ±yla gÃ¼ncellendi!<br>Hesap: ${resetEmail}<br>Yeni ÅŸifre: ${newPassword}<br><br>âš ï¸ Yeni ÅŸifre console'da gÃ¶rÃ¼nÃ¼yor!`, 'success');

            console.log('Password reset successful:', {
                email: resetEmail,
                newPassword: newPassword,
                token: localStorage.getItem('resetToken'),
                timestamp: new Date().toISOString()
            });

            setTimeout(() => {
                window.location.href = 'login.html';
            }, 3000);
        });

        function showMessage(message, type) {
            const messageDiv = document.getElementById('message');
            messageDiv.className = `alert alert-${type}`;
            messageDiv.innerHTML = message;
        }

        // Check if coming from reset link
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        if (token) {
            // Vulnerable: No token validation
            try {
                const decoded = atob(token);
                const [email, timestamp] = decoded.split(':');
                
                localStorage.setItem('resetToken', token);
                localStorage.setItem('resetEmail', email);
                
                document.getElementById('resetFormContainer').style.display = 'block';
                showMessage(`Token geÃ§erli! ${email} iÃ§in ÅŸifre sÄ±fÄ±rlama<br>âš ï¸ Token asla expire olmaz!`, 'warning');
            } catch (e) {
                showMessage('GeÃ§ersiz token', 'danger');
            }
        }

        // Vulnerable: Exposing reset statistics
        console.log('Reset attempts from this IP:', resetAttempts);
        console.log('Rate limiting: DISABLED');
        console.log('Known users:', existingUsers);
    </script>
</body>
</html>
