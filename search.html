<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Search - Security Lab</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">üîê Security Lab</div>
            <ul class="nav-menu">
                <li><a href="index.html">Ana Sayfa</a></li>
                <li><a href="search.html">Arama</a></li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <div class="hero">
            <h1>üîç Search Functionality</h1>
            <p class="subtitle">SQL Injection | XSS | LDAP Injection Testing</p>
        </div>

        <div class="warning-box">
            <h2>‚ö†Ô∏è Vulnerable Search</h2>
            <p>Bu arama sistemi SQL Injection, XSS ve diƒüer injection saldƒ±rƒ±larƒ±na a√ßƒ±ktƒ±r.</p>
        </div>

        <div class="form-container">
            <h2>üîé Kullanƒ±cƒ± Arama</h2>
            <form id="searchForm">
                <div class="form-group">
                    <input type="text" id="searchQuery" placeholder="Kullanƒ±cƒ± ara..." style="width: 80%; display: inline-block;">
                    <button type="submit" class="btn btn-primary" style="width: 18%; display: inline-block;">Ara</button>
                </div>
            </form>

            <div id="searchResults" style="margin-top: 2rem;"></div>
        </div>

        <div class="test-categories" style="margin-top: 2rem;">
            <div class="category-card">
                <h2>üíâ SQL Injection Payloads</h2>
                <div class="code-block">
                    ' OR '1'='1<br>
                    ' OR 1=1--<br>
                    ' UNION SELECT null, username, password FROM users--<br>
                    ' AND 1=0 UNION ALL SELECT table_name FROM information_schema.tables--<br>
                    '; DROP TABLE users;--<br>
                    ' OR 'a'='a<br>
                    admin'--<br>
                    ' OR 1=1 LIMIT 1;--
                </div>
                <button class="btn btn-danger" onclick="testSQLi()">Test SQL Injection</button>
            </div>

            <div class="category-card">
                <h2>üé® XSS Payloads</h2>
                <div class="code-block">
                    &lt;script&gt;alert('XSS')&lt;/script&gt;<br>
                    &lt;img src=x onerror=alert('XSS')&gt;<br>
                    &lt;svg onload=alert('XSS')&gt;<br>
                    &lt;iframe src="javascript:alert('XSS')"&gt;<br>
                    &lt;body onload=alert('XSS')&gt;<br>
                    javascript:alert('XSS')
                </div>
                <button class="btn btn-warning" onclick="testXSS()">Test XSS</button>
            </div>

            <div class="category-card">
                <h2>üîê LDAP Injection</h2>
                <div class="code-block">
                    *)(uid=*))(|(uid=*<br>
                    admin)(|(password=*))<br>
                    *)(objectClass=*<br>
                    *))%00
                </div>
                <button class="btn btn-primary" onclick="testLDAP()">Test LDAP Injection</button>
            </div>

            <div class="category-card">
                <h2>üìä Query Statistics</h2>
                <div id="queryStats">
                    <p>Toplam Arama: <strong id="totalSearches">0</strong></p>
                    <p>SQL Injection Denemesi: <strong id="sqliAttempts">0</strong></p>
                    <p>XSS Denemesi: <strong id="xssAttempts">0</strong></p>
                    <p style="color: #dc2626;">‚ö†Ô∏è Saldƒ±rƒ±lar engellenmedi!</p>
                </div>
            </div>
        </div>

        <!-- Simulated SQL Query Log -->
        <div class="data-table" style="margin-top: 2rem;">
            <h3 style="padding: 1rem;">üìã SQL Query Log (Exposed!)</h3>
            <table>
                <thead>
                    <tr>
                        <th>Timestamp</th>
                        <th>Query</th>
                        <th>Results</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody id="queryLog">
                </tbody>
            </table>
        </div>
    </div>

    <footer>
        <p>üîì Deliberately Vulnerable Search</p>
    </footer>

    <script>
        const users = [
            { id: 1, username: 'admin', email: 'admin@test.com', password: 'Admin123!', role: 'admin' },
            { id: 2, username: 'user', email: 'user@test.com', password: 'User123!', role: 'user' },
            { id: 3, username: 'test', email: 'test@test.com', password: 'Test123!', role: 'user' },
            { id: 4, username: 'john', email: 'john@test.com', password: 'John123!', role: 'user' },
            { id: 5, username: 'jane', email: 'jane@test.com', password: 'Jane123!', role: 'user' }
        ];

        let searchCount = 0;
        let sqliCount = 0;
        let xssCount = 0;

        document.getElementById('searchForm').addEventListener('submit', function(e) {
            e.preventDefault();
            performSearch();
        });

        function performSearch() {
            const query = document.getElementById('searchQuery').value;
            searchCount++;

            // Detect (but don't prevent) attacks
            if (query.includes("'") || query.includes("--") || query.includes("UNION")) {
                sqliCount++;
                console.warn('SQL Injection attempt detected:', query);
            }

            if (query.includes("<script>") || query.includes("onerror") || query.includes("onload")) {
                xssCount++;
                console.warn('XSS attempt detected:', query);
            }

            updateStats();

            // Vulnerable: Build SQL query with user input
            const sqlQuery = `SELECT * FROM users WHERE username LIKE '%${query}%' OR email LIKE '%${query}%'`;
            
            logQuery(sqlQuery);

            // Simulate search results (vulnerable to various attacks)
            let results = '';

            if (query.includes("' OR '1'='1") || query.includes("' OR 1=1")) {
                // SQL Injection - return all users
                results = '<div class="alert alert-danger"><strong>SQL Injection Successful!</strong> All users returned:</div>';
                results += '<div class="data-table"><table><thead><tr><th>ID</th><th>Username</th><th>Email</th><th>Password</th><th>Role</th></tr></thead><tbody>';
                users.forEach(user => {
                    results += `<tr>
                        <td>${user.id}</td>
                        <td>${user.username}</td>
                        <td>${user.email}</td>
                        <td>${user.password}</td>
                        <td>${user.role}</td>
                    </tr>`;
                });
                results += '</tbody></table></div>';
            } else if (query.includes("UNION")) {
                // UNION-based SQL Injection
                results = '<div class="alert alert-danger"><strong>UNION SQL Injection Successful!</strong></div>';
                results += '<div class="code-block">';
                results += 'Database: production\n';
                results += 'Tables: users, sessions, logs, config\n';
                results += 'Admin password hash: $2y$10$92IXUNpkjO0rOQ5byMi.Ye4oKoEa3Ro9llC/.og/at2.uheWG/igi';
                results += '</div>';
            } else if (query.includes("<script>") || query.includes("<img")) {
                // XSS - reflected
                results = `<div class="alert alert-warning"><strong>XSS Vulnerable!</strong> Your input: ${query}</div>`;
                results += `<p>Reflected content: ${query}</p>`;
            } else {
                // Normal search (still vulnerable to injection)
                const matchedUsers = users.filter(u => 
                    u.username.toLowerCase().includes(query.toLowerCase()) || 
                    u.email.toLowerCase().includes(query.toLowerCase())
                );

                if (matchedUsers.length > 0) {
                    results = '<div class="data-table"><table><thead><tr><th>Username</th><th>Email</th><th>Role</th></tr></thead><tbody>';
                    matchedUsers.forEach(user => {
                        results += `<tr>
                            <td>${user.username}</td>
                            <td>${user.email}</td>
                            <td><span class="badge badge-${user.role === 'admin' ? 'danger' : 'success'}">${user.role}</span></td>
                        </tr>`;
                    });
                    results += '</tbody></table></div>';
                } else {
                    results = '<div class="alert alert-warning">Sonu√ß bulunamadƒ±</div>';
                }
            }

            document.getElementById('searchResults').innerHTML = results;
        }

        function testSQLi() {
            document.getElementById('searchQuery').value = "' OR '1'='1";
            performSearch();
        }

        function testXSS() {
            document.getElementById('searchQuery').value = "<script>alert('XSS')</script>";
            performSearch();
        }

        function testLDAP() {
            document.getElementById('searchQuery').value = "*)(uid=*))(|(uid=*";
            performSearch();
        }

        function logQuery(query) {
            const logTable = document.getElementById('queryLog');
            const row = logTable.insertRow(0);
            
            const resultCount = Math.floor(Math.random() * 10);
            const status = query.includes("'") ? 'VULNERABLE' : 'EXECUTED';
            
            row.innerHTML = `
                <td>${new Date().toLocaleTimeString()}</td>
                <td style="font-family: monospace; font-size: 0.875rem;">${query}</td>
                <td>${resultCount} rows</td>
                <td><span class="badge badge-${status === 'VULNERABLE' ? 'danger' : 'success'}">${status}</span></td>
            `;

            if (logTable.rows.length > 10) {
                logTable.deleteRow(10);
            }
        }

        function updateStats() {
            document.getElementById('totalSearches').textContent = searchCount;
            document.getElementById('sqliAttempts').textContent = sqliCount;
            document.getElementById('xssAttempts').textContent = xssCount;
        }

        // Vulnerable: Exposing database schema
        console.log('Database Schema:', {
            table: 'users',
            columns: ['id', 'username', 'email', 'password', 'role', 'created_at'],
            sample_query: "SELECT * FROM users WHERE id = 1",
            injection_point: 'username parameter',
            vulnerable: true
        });

        // Check URL parameters for reflected XSS
        const urlParams = new URLSearchParams(window.location.search);
        const searchParam = urlParams.get('q');
        if (searchParam) {
            document.getElementById('searchQuery').value = searchParam;
            performSearch();
        }
    </script>
</body>
</html>
